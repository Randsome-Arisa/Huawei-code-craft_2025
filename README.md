*任务书* 和 *样例数据说明* 这两个 PDF 转成了 TXT 格式，方便上传给 AI 进行解析处理。

# 题目理解
## 符号含义
| 符号  | 含义                |
| --- | ----------------- |
| T   | 共T+105个时间片        |
| M   | 对象标签种数            |
| N   | 硬盘数               |
| V   | 每个硬盘的存储单元数        |
| G   | 每个时间片每个磁头最多消耗的令牌数 |

- 每块硬盘有 V 个 *存储单元*，每个存储单元可以存一个 *对象块*；
- 尽量顺序存储；
- 任何时间存储系统中空余的存储单元数占总存储单元数的至少 10%；
- 删除越多的越应该优先读（否则可能读一半被删导致没分）；
- 写入阶段需要在该时间片处理所有的写入请求；
- $1≤𝑜𝑏𝑗_𝑠𝑖𝑧𝑒[𝑖]≤5$，说明都是小对象。远小于磁盘大小的 5000。
# 优化方向
## 写优化
避免碎片化，负载均衡，利于顺序读取。
### 分配算法优化
第一版：First Fit 算法。
第二版：分离空闲链表，采用 Worst Fit 算法。
### 磁盘选择算法优化
第一版：$(id+j)\%N$ 选择磁盘。 
第二版：可用连续空间最空闲调度。
- 尽量选择空闲的；
- 尽量选择与该对象同标签少的磁盘
	在 *越相近的标签越容易同时被请求* 的前提下有利于并行读取，因为假设请求1读取在磁盘1、2、3上的标签为1的对象1，请求2也读取标签为1的对象2，如果对象2也在1、2、3磁盘上，需要读完对象1再读对象2，如果对象2在磁盘4、5、6上，就可以并行读了。
## 读优化
### 读调度算法优化
- 优先读取即将被删除的对象，避免拿不到分。
- 优先读取即将完成的对象，优先读取size比较大的对象。

> 注意读取的单位不是对象，而是对象块，因此优先队列存储的应该是每个待读对象块的距离成本，优先级可以综合考虑距离成本、所属对象大小、所属对象剩余所需时间片等因素。
# 实现方法
- 每个磁盘维护一个分离空闲链表管理内存，功能包括分配、释放、合并存储单元。
- 维护一个磁盘调度器进行删除和读写操作，以及选择读、写操作的磁盘。
- 选择的方法是用 `priority_queue` 维护一个磁盘队列和请求队列，根据优先级进行选择。
- 预处理时，用一个三维数组 `tag_info[tag][epoch][删/写/读]` 存储每个标签在每个 epoch 中删除、写入、读取的对象块数量。
- 维护一个二维标签热度数组 `tag_heat[tag][epoch]`，本轮和下一轮中（这个窗口可以调整）该标签读得越多越热，删得越少越热。对于更热的标签，优先写入。
只有对象类的副本 `Replicas[REP_NUM]` 从 0 开始索引，其他都从 1 开始。
# TODO
- [x] 写入分配算法
- [x] 写入和删除算法
- [x] 读取调度算法
- [x] 任何时间存储系统中空余的存储单元数占总存储单元数的至少 10%
- [x] 检查下标是从0开始还是从1开始是否统一
- [x] 请求队列优先级定义
- [x] 对写入时间片的所有写入处理排序后再写入，优化写入算法
- [ ] 多磁盘并行读取，多对象并发读取
- [ ] 错误异常处理
- [ ] 利用预处理的全局信息和测试文件的规律，改进分离空闲链表的初始化方法，强化对标签的利用
# 心得
- `priority_queue` 自定义比较函数时，如果期望优先级大的在队首，比较函数中应该对优先级小的返回 true；
- 自定义比较函数可以用 lambda 表达式，也可以用结构体；
- Lambda 表达式实际上就是一个匿名函数对象，语法是 `[capture](parameters) -> return_type { function_body }`；
	其中，capture 是 Lambda 表达式中可能用到的外部变量，可以选择按值或按引用捕获。
	return_type 可以省略，编译器会自动推断。
- 优先队列第三个参数需要一个类型作为比较函数，而不是一个函数对象，因此需要用 `decltype` 来获取 Lambda 函数对象的类型。
	例如，`priority_queue<Request, vector<Request>, decltype(cmp)> pq(cmp)`。
- 即使类成员的 vector 没有初始化，类函数中的 vector[i] 也不会报错，但是程序不能正常运行。正确的做法是在构造函数中用初始化列表将其大小初始化；
- 用 git 进行开发时最好每一个功能都写一个分支，这样可以方便回退；
- 如果不小心错误地提交了代码，可以用 `git revert` 撤销提交；
- 注意使用 `git pull` 可能会覆盖本地代码；